kind: TestCase/v0
name: sample test case
step:
- name: prepare data 1
  id: prep-1
  kind: PostgreSQL
  params:
    query: "INSERT INTO users (name, email, age) VALUES ('Taro yamada', 'yamada@example.com', 30);"
- name: prepare data 2
  kind: PostgreSQL
  params:
    fromFile: prep2.sql
- name: execute pre-test api
  kind: RESTApiExecution
  id: api_execution
  params:
    request
      url: "{baseUrl}/sample/1"
      method: POST
      headers:
      - content-type: application/json
      - x-testcase-id: "{testCaseId}"
      body:
        hello: world
        sample:
          sample2:
          - this
          - is
          - array
    responseAssertion:
      stats: 200
      headers:
      - content-type: [!null]
      - x-testcase-id: [!null]
      - x-invalid-header: [null]
      body:
        message: [null]
        hello: world
        sample:
          sample2:
          - this
          - is
          - array
- name: validation table
  id: valid-1
  kind: PostgreSQL
  params:
    query: "SELECT FROM users WHERE name='Taro yamada';"
  responseAssertion:
    name: 'Taro yamada'
    age: [api_execution.response.status]
- name: cleanup table
  kind: PostgreSQL
  params:
    query: "DELETE users WHERE name='Taro yamada';"
  responseAssertion:
    rowsAffected: 1
